<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description" content="像孩子一样写代码"><meta name="keywords" content="CSS, JavaScript, NodeJS, Vue, React, Sketch, Git"><title>（转|译）在AngularJS中使用的表单验证功能 - voya</title><link rel="stylesheet" href="/css/jquery.tocify.css"><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="http://oe54phg1r.bkt.clouddn.com/favicon32x32.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="/categories/365/"><span>忆</span></a></li><li><a href="/categories/css-tutorial/"><span>CSS 教程</span></a></li></ul><div class="wrapper wrapper--article" id="wrap"><div class="hide" id="toc"><div class="toc-text">Table of Content ▾</div></div><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">（转|译）在AngularJS中使用的表单验证功能</h1><ul class="meta"><li><i class="icon icon-author"></i>voya</li><li><i class="icon icon-clock"></i>46 Minutes</li><li><i class="icon icon-calendar"></i>2015年8月6日</li></ul></div></div><div class="article-content" style="max-width:700px"><p>验证功能是AngularJS里面最酷炫的功能之一，它可以让你写出一个具有良好用户体验的Web应用。</p>
<p>在AngularJS中，有许多用于验证的指令。我们将先学习几个最流行的内置指令，然后再创建一个自定义验证规则的指令。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"form"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">name</span>=<span class="string">"email"</span>&gt;</span>Your email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">ng-model</span>=<span class="string">"email"</span> <span class="attr">placeholder</span>=<span class="string">"Email Address"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>AngularJS</strong>可以让我们轻松的处理客户端验证。虽然我们不能仅靠客户端验证来保证我们Web应用的安全性，但他们提供了良好用户体验。</p>
<a id="more"></a>
<p>我们首先必须确保<strong>form</strong>上标签有一个<strong>name</strong>属性，像上面的例子一样。</p>
<p>我们可以进行一些基本的验证，例如最小长度，最大长度，等等，这些都是<strong>HTML5</strong>自带的属性验证功能。</p>
<p><strong>Tips:</strong>通常需要在form标签中加上<strong>novalidate</strong>属性，这样可以禁用浏览器自带的验证功能，从而使用<strong>AngularJS</strong>提供的。</p>
<p>下面来看看我们可以在input中设置哪些验证：</p>
<h2 id="必填"><a href="#必填" class="headerlink" title="必填"></a>必填</h2><p>验证是否已输入文字，只需在标签上加上<strong>required</strong>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">required</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="最小长度"><a href="#最小长度" class="headerlink" title="最小长度"></a>最小长度</h2><p>验证至少输入<code>{number}</code>个字符，使用指令<code>ng-minlength=&quot;{number}&quot;</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-minlength</span>=<span class="string">5</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="最大长度"><a href="#最大长度" class="headerlink" title="最大长度"></a>最大长度</h2><p>验证至多输入<code>{number}</code>个字符，使用指令<code>ng-maxlength=&quot;{number}&quot;</code>：</p>
<h2 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h2><p>确保输入匹配一个<strong>正则表达式</strong>，使用指令<code>ng-pattern=&quot;/PATTERN/&quot;</code>:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-pattern</span>=<span class="string">"/a-zA-Z/"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Email"><a href="#Email" class="headerlink" title="Email"></a>Email</h2><p>验证输入是一个<strong>Email</strong>，设置input的type属性为<code>email</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">ng-model</span>=<span class="string">"user.email"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><p>验证输入是一个<strong>数字</strong>，设置input的type属性为<code>number</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"number"</span> <span class="attr">name</span>=<span class="string">"number"</span> <span class="attr">ng-model</span>=<span class="string">"user.age"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Url"><a href="#Url" class="headerlink" title="Url"></a>Url</h2><p>验证输入是一个<strong>URL</strong>，设置input的type属性为<code>url</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"url"</span> <span class="attr">name</span>=<span class="string">"homepage"</span> <span class="attr">ng-model</span>=<span class="string">"user.facebook_url"</span> /&gt;</span></div></pre></td></tr></table></figure>
<h2 id="自定义验证"><a href="#自定义验证" class="headerlink" title="自定义验证"></a>自定义验证</h2><p>AngularJS可以很容易的使用指令来添加自定义验证。例如，我们要验证我们的用户名是可用的（在数据库中不重复）。要做到这一点，我们将实现一个指令，它在输入字符变化时触发一个<strong>Ajax</strong>请求：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'validationExample'</span>, []);</div><div class="line"></div><div class="line">app.directive(<span class="string">'ensureUnique'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">require</span>: <span class="string">'ngModel'</span>,</div><div class="line">    <span class="attr">link</span>: <span class="function"><span class="keyword">function</span>(<span class="params">scope, ele, attrs, c</span>) </span>&#123;</div><div class="line">      scope.$watch(attrs.ngModel, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $http(&#123;</div><div class="line">          <span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">          <span class="attr">url</span>: <span class="string">'/api/check/'</span> + attrs.ensureUnique,</div><div class="line">          <span class="attr">data</span>: &#123;<span class="string">'field'</span>: attrs.ensureUnique&#125;</div><div class="line">        &#125;).success(<span class="function"><span class="keyword">function</span>(<span class="params">data, status, headers, cfg</span>) </span>&#123;</div><div class="line">          c.$setValidity(<span class="string">'unique'</span>, data.isUnique);</div><div class="line">        &#125;).error(<span class="function"><span class="keyword">function</span>(<span class="params">data, status, headers, cfg</span>) </span>&#123;</div><div class="line">          c.$setValidity(<span class="string">'unique'</span>, <span class="literal">false</span>);</div><div class="line">        &#125;);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<h2 id="验证表单状态"><a href="#验证表单状态" class="headerlink" title="验证表单状态"></a>验证表单状态</h2><p>AngularJS将DOM验证的结果保存在$scope对象中。这使我们能够实时做出一些处理。提供给我们的属性有：</p>
<p>请注意，这是这个属性的格式：</p>
<p><code>formName.inputFieldName.property</code></p>
<h3 id="未修改过的表单"><a href="#未修改过的表单" class="headerlink" title="未修改过的表单"></a>未修改过的表单</h3><p>表示用户是否修改了表单。如果为ture，表示没有修改过：</p>
<p><code>formName.inputFieldName.$pristine;</code></p>
<h3 id="修改的表单"><a href="#修改的表单" class="headerlink" title="修改的表单"></a>修改的表单</h3><p>当且用户是否已经修改过表单：</p>
<p><code>formName.inputFieldName.$dirty</code></p>
<h3 id="经过验证的表单"><a href="#经过验证的表单" class="headerlink" title="经过验证的表单"></a>经过验证的表单</h3><h3 id="表示否通过验证："><a href="#表示否通过验证：" class="headerlink" title="表示否通过验证："></a>表示否通过验证：</h3><p><code>formName.inputFieldName.$valid</code></p>
<h3 id="未通过验证的表单"><a href="#未通过验证的表单" class="headerlink" title="未通过验证的表单"></a>未通过验证的表单</h3><p>表示否通过验证。如果表单当前没有通过验证，他将为true：</p>
<p><code>formName.inputFieldName.$invalid</code></p>
<p>最后两个属性在用于DOM元素的显示或隐藏时是特别有用的。当然，如果想要设置特定的class时，他们也是非常有用的。</p>
<h3 id="错误"><a href="#错误" class="headerlink" title="错误"></a>错误</h3><p>另一个有用的属性是AngularJS提供的<code>$error</code>对象。这个对象包含每一个无效的input验证的集合。为了访问这个属性，使用下面的语法：</p>
<p><code>formName.inputfieldName.$error</code></p>
<p>如果验证失败，则此属性将是<code>true</code>的(因为<code>length&gt;0</code>)。</p>
<h3 id="控制验证时的样式"><a href="#控制验证时的样式" class="headerlink" title="控制验证时的样式"></a>控制验证时的样式</h3><p>当AngularJS处理的验证时，它将根据验证的状态增加一些特定的class属性。</p>
<p>这些class是:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.ng-pristine</span> &#123;&#125;</div><div class="line"><span class="selector-class">.ng-dirty</span> &#123;&#125;</div><div class="line"><span class="selector-class">.ng-valid</span> &#123;&#125;</div><div class="line"><span class="selector-class">.ng-invalid</span> &#123;&#125;</div></pre></td></tr></table></figure>
<p>这些class对应着其对应的验证对象的结果。</p>
<p>当一个字段是无效的，<code>.ng-invalid</code>将被应用到这个字段上。我们可以通过css来设置这些class的样式:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">input</span><span class="selector-class">.ng-invalid</span> &#123;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid red;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">input</span><span class="selector-class">.ng-valid</span> &#123;</div><div class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid green;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="全部放一起试试"><a href="#全部放一起试试" class="headerlink" title="全部放一起试试"></a>全部放一起试试</h2><p>让我们编写一个注册表单。本申请表单将包括姓名，Email，以及用户名。</p>
<h3 id="让我们定义一个form表单"><a href="#让我们定义一个form表单" class="headerlink" title="让我们定义一个form表单:"></a>让我们定义一个form表单:</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"signup_form"</span> <span class="attr">novalidate</span> <span class="attr">ng-submit</span>=<span class="string">"signupForm()"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Signup<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"button radius"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这个表单的名字是<code>signup_form</code> ，当我们点击提交时我们将调用<code>signupForm()</code>方法.</p>
<h3 id="现在，让我们添加用户的Name"><a href="#现在，让我们添加用户的Name" class="headerlink" title="现在，让我们添加用户的Name:"></a>现在，让我们添加用户的<code>Name</code>:</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Your name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> </span></div><div class="line">        <span class="attr">placeholder</span>=<span class="string">"Name"</span> </div><div class="line">        <span class="attr">name</span>=<span class="string">"name"</span> </div><div class="line">        <span class="attr">ng-model</span>=<span class="string">"signup.name"</span> </div><div class="line">        <span class="attr">ng-minlength</span>=<span class="string">3</span> </div><div class="line">        <span class="attr">ng-maxlength</span>=<span class="string">20</span> <span class="attr">required</span> /&gt;</div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我们增加了一个名字为<code>name</code>的输入框，并且将对象绑定在<code>$scope</code>对象的<code>signup.name</code>对象上（通过<code>ng-model</code>）。</p>
<p>我们还设置了几个验证。这些验证分别是：必须有一个长度为3或更多的名字。并且最大长度限制为20个字符。最后，名称应该是必填的。</p>
<p>让我们用属性来控制显示还是隐藏错误信息。我们还将使用$dirty属性，以确保当用户没有输入字符前错误信息不会显示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Your name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> </span></div><div class="line">        <span class="attr">placeholder</span>=<span class="string">"Name"</span> </div><div class="line">        <span class="attr">name</span>=<span class="string">"name"</span> </div><div class="line">        <span class="attr">ng-model</span>=<span class="string">"signup.name"</span> </div><div class="line">        <span class="attr">ng-minlength</span>=<span class="string">3</span> </div><div class="line">        <span class="attr">ng-maxlength</span>=<span class="string">20</span> <span class="attr">required</span> /&gt;</div><div class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">        <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$dirty &amp;&amp; signup_form.name.$invalid"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">        <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.required"</span>&gt;</div><div class="line">        Your name is required.</div><div class="line">    <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">            <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.minlength"</span>&gt;</div><div class="line">            Your name is required to be at least 3 characters</div><div class="line">    <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">            <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.maxlength"</span>&gt;</div><div class="line">            Your name cannot be longer than 20 characters</div><div class="line">    <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在之前，当输入内容改变时它只能告诉我们我们输入是否有效。现在，我们将看到当那些没有通过的验证时的错误信息。</p>
<h3 id="让我们接着看Email验证"><a href="#让我们接着看Email验证" class="headerlink" title="让我们接着看Email验证:"></a>让我们接着看Email验证:</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>          </div><div class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">label</span>&gt;</span>Your email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"email"</span> </span></div><div class="line">      <span class="attr">placeholder</span>=<span class="string">"Email"</span> </div><div class="line">      <span class="attr">name</span>=<span class="string">"email"</span> </div><div class="line">      <span class="attr">ng-model</span>=<span class="string">"signup.email"</span> </div><div class="line">      <span class="attr">ng-minlength</span>=<span class="string">3</span> <span class="attr">ng-maxlength</span>=<span class="string">20</span> <span class="attr">required</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">         <span class="attr">ng-show</span>=<span class="string">"signup_form.email.$dirty &amp;&amp; signup_form.email.$invalid"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">             <span class="attr">ng-show</span>=<span class="string">"signup_form.email.$error.required"</span>&gt;</div><div class="line">             Your email is required.</div><div class="line">      <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">             <span class="attr">ng-show</span>=<span class="string">"signup_form.email.$error.minlength"</span>&gt;</div><div class="line">              Your email is required to be at least 3 characters</div><div class="line">      <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">             <span class="attr">ng-show</span>=<span class="string">"signup_form.email.$error.email"</span>&gt;</div><div class="line">             That is not a valid email. Please input a valid email.</div><div class="line">      <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">             <span class="attr">ng-show</span>=<span class="string">"signup_form.email.$error.maxlength"</span>&gt;</div><div class="line">              Your email cannot be longer than 20 characters</div><div class="line">      <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这一次，我们增加了<strong>Email</strong>字段。请注意，我们设置了input的type属性为email并且添加了$error.email错误信息。这是基于AngularJS的Email验证（使用了HTML5属性）。</p>
<h3 id="最后，让我们来看看在我们的最后一个验证，用户名："><a href="#最后，让我们来看看在我们的最后一个验证，用户名：" class="headerlink" title="最后，让我们来看看在我们的最后一个验证，用户名："></a>最后，让我们来看看在我们的最后一个验证，用户名：</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">label</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"text"</span> </span></div><div class="line">            <span class="attr">placeholder</span>=<span class="string">"Desired username"</span> </div><div class="line">            <span class="attr">name</span>=<span class="string">"username"</span> </div><div class="line">            <span class="attr">ng-model</span>=<span class="string">"signup.username"</span> </div><div class="line">            <span class="attr">ng-minlength</span>=<span class="string">3</span> </div><div class="line">            <span class="attr">ng-maxlength</span>=<span class="string">20</span> </div><div class="line">            <span class="attr">ensure-unique</span>=<span class="string">"username"</span> <span class="attr">required</span> /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.username.$dirty &amp;&amp; signup_form.username.$invalid"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.username.$error.required"</span>&gt;</span>Please input a username<span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.username.$error.minlength"</span>&gt;</span>Your username is required to be at least 3 characters<span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.username.$error.maxlength"</span>&gt;</span>Your username cannot be longer than 20 characters<span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.username.$error.unique"</span>&gt;</span>That username is taken, please try another<span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在我们的最后一个字段，我们使用之前编写的自定义验证指令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">'ensureUnique'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">require</span>: <span class="string">'ngModel'</span>,</div><div class="line">    <span class="attr">link</span>: <span class="function"><span class="keyword">function</span>(<span class="params">scope, ele, attrs, c</span>) </span>&#123;</div><div class="line">      scope.$watch(attrs.ngModel, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $http(&#123;</div><div class="line">          <span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">          <span class="attr">url</span>: <span class="string">'/api/check/'</span> + attrs.ensureUnique,</div><div class="line">          <span class="attr">data</span>: &#123;<span class="string">'field'</span>: attrs.ensureUnique&#125;</div><div class="line">        &#125;).success(<span class="function"><span class="keyword">function</span>(<span class="params">data, status, headers, cfg</span>) </span>&#123;</div><div class="line">          c.$setValidity(<span class="string">'unique'</span>, data.isUnique);</div><div class="line">        &#125;).error(<span class="function"><span class="keyword">function</span>(<span class="params">data, status, headers, cfg</span>) </span>&#123;</div><div class="line">          c.$setValidity(<span class="string">'unique'</span>, <span class="literal">false</span>);</div><div class="line">        &#125;);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>当表单输入是有效的时，它将发送POST api/check/username请求到服务器来检查用户名是否可用。很明显，因为我们在这里只谈论前端代码，我们写后端代码，尽管很容易。</p>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新:"></a>更新:</h2><p>根据评论，我加入了服务器超时检查。要查看完整的源代码，请点击<a href="https://gist.github.com/auser/6417470" target="_blank" rel="external">here</a>。</p>
<p>最后，我们加上提交按钮，根据验证是否有效使用<code>ng-disabled</code>来控制按钮的禁用和启用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"signup_form.$invalid"</span> <span class="attr">class</span>=<span class="string">"button radius"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div></pre></td></tr></table></figure>
<p>正如我们上面所说的，表单是否有效的属性<code>$invalid</code>给我们提供了便利。</p>
<h2 id="更新-2"><a href="#更新-2" class="headerlink" title="更新 2:"></a>更新 2:</h2><p>虽然及时验证很棒，它可以立即提醒用户，但是当他们正在输入很长的能通过验证的文字时，他们将在输入中途看到错误提示。有更好的方式来处理验证：当用户点击提交时，或者当他们将光标移开输入框之后。让我们来看看这2种方式。</p>
<h3 id="点击提交后显示验证信息"><a href="#点击提交后显示验证信息" class="headerlink" title="点击提交后显示验证信息"></a>点击提交后显示验证信息</h3><p>要在用户试图提交表单时显示的验证，你可以通过在scope中设置一个’submitted’值，并检查该值来控制显示错误。</p>
<p>让我们来看看第一个例子，只有在点击提交表单时才显示错误。使用<code>ng-show</code>指令来控制显示，我们可以添加一个检查，看是否已点击提交按钮：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"signup_form"</span> <span class="attr">novalidate</span> <span class="attr">ng-submit</span>=<span class="string">"signupForm()"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Signup<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Your name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> </span></div><div class="line">            <span class="attr">placeholder</span>=<span class="string">"Name"</span> </div><div class="line">            <span class="attr">name</span>=<span class="string">"name"</span> </div><div class="line">            <span class="attr">ng-model</span>=<span class="string">"signup.name"</span> </div><div class="line">            <span class="attr">ng-minlength</span>=<span class="string">3</span> </div><div class="line">            <span class="attr">ng-maxlength</span>=<span class="string">20</span> <span class="attr">required</span> /&gt;</div><div class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">            <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$dirty &amp;&amp; signup_form.name.$invalid &amp;&amp; signup_form.submitted"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">            <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.required"</span>&gt;</div><div class="line">            Your name is required.</div><div class="line">        <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">                <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.minlength"</span>&gt;</div><div class="line">                Your name is required to be at least 3 characters</div><div class="line">        <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">small</span> <span class="attr">class</span>=<span class="string">"error"</span> </span></div><div class="line">                <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$error.maxlength"</span>&gt;</div><div class="line">                Your name cannot be longer than 20 characters</div><div class="line">        <span class="tag">&lt;/<span class="name">small</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"button radius"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<p>现在，那个错误信息只将在<code>signup_form.submitted</code>为<code>true</code>时才显示。我们可以这样实现<code>signupForm</code>方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">app.controller('signupController', ['$scope', function($scope) &#123;</div><div class="line">  $scope.submitted = false;</div><div class="line">  $scope.signupForm = function() &#123;</div><div class="line">    if ($scope.signup_form.$valid) &#123;</div><div class="line">      // Submit as normal</div><div class="line">    &#125; else &#123;</div><div class="line">      $scope.signup_form.submitted = true;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>现在，当用户尝试提交表单并且同时有一个无效的元素时，你可以捕获它，并告诉他们错误的原因。</p>
<h3 id="当时去焦点时验证错误"><a href="#当时去焦点时验证错误" class="headerlink" title="当时去焦点时验证错误"></a>当时去焦点时验证错误</h3><p>如果你想保留错误验证的实时性，那么可以在用户离开该输入框时显示错误信息。要做到这一点，我们可以添加一个指令，将添加一个新的变量。</p>
<p>我们使用ngFocus指令：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">'ngFocus'</span>, [<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> FOCUS_CLASS = <span class="string">"ng-focused"</span>;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">restrict</span>: <span class="string">'A'</span>,</div><div class="line">    <span class="attr">require</span>: <span class="string">'ngModel'</span>,</div><div class="line">    <span class="attr">link</span>: <span class="function"><span class="keyword">function</span>(<span class="params">scope, element, attrs, ctrl</span>) </span>&#123;</div><div class="line">      ctrl.$focused = <span class="literal">false</span>;</div><div class="line">      element.bind(<span class="string">'focus'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        element.addClass(FOCUS_CLASS);</div><div class="line">        scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;ctrl.$focused = <span class="literal">true</span>;&#125;);</div><div class="line">      &#125;).bind(<span class="string">'blur'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123;</div><div class="line">        element.removeClass(FOCUS_CLASS);</div><div class="line">        scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;ctrl.$focused = <span class="literal">false</span>;&#125;);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;]);</div></pre></td></tr></table></figure>
<p>要使用<code>ngFocus</code>，我们只需要简单加上这个指令到输入框元素上，像这样：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-class</span>=<span class="string">"&#123;error: signup_form.name.$dirty &amp;&amp; signup_form.name.$invalid&#125;"</span> </span></div><div class="line"><span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Name"</span> <span class="attr">name</span>=<span class="string">"name"</span> </div><div class="line"><span class="attr">ng-model</span>=<span class="string">"signup.name"</span> <span class="attr">ng-minlength</span>=<span class="string">3</span> <span class="attr">ng-maxlength</span>=<span class="string">20</span> <span class="attr">required</span> <span class="attr">ng-focus</span> /&gt;</div></pre></td></tr></table></figure>
<p>加上<code>ngFocus</code>指令后，将在输入框的<code>blur</code>和<code>focus</code>事件中注册相应操作，当焦点在该输入框时，它添加一个<code>class（ng-focused）</code>，并且该输入框的<code>$focused</code>属性也将变为<code>true</code>。因此，你可以根据需求是否在焦点上来个性化设置显示错误消息。例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"error"</span> <span class="attr">ng-show</span>=<span class="string">"signup_form.name.$dirty &amp;&amp; signup_form.name.$invalid &amp;&amp; !signup_form.name.$focused"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我希望这篇文章可以告诉你如何很酷炫的使用AngularJS来进行验证。</p>
<p>原文：<a href="http://www.ng-newsletter.com/posts/validations.html" target="_blank" rel="external">Form validation with AngularJS (en)</a><br>译文原文：<a href="http://www.cnblogs.com/woshinidezhu/p/form-validation-with-angularjs.html" target="_blank" rel="external">http://www.cnblogs.com/woshinidezhu/p/form-validation-with-angularjs.html</a></p>
</div><div class="article-meta" style="max-width:700px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AngularJS/">AngularJS</a><span class="tag-list-count">3</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/posts/12846/"><i class="icon icon-arror-left"></i></a></li><li><a href="/posts/19847/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="bottom"><p class="copyright">© 2017 voya<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small></p></div></div></div><script src="/js/jquery-1.8.3.min.js"></script><script src="/js/jquery-ui-1.9.1.custom.min.js"></script><script src="/js/jquery.tocify.min.js"></script><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
  if(document.querySelector('#toc')){
    $("#toc").tocify({
      context: 'body',
      selectors: "h2,h3,h4,h5",
      extendPage: false,
    }).data("toc-tocify");

    const toc = document.querySelector('.tocify');
    function toggleToc(){
      toc.classList.toggle('hide');
    }
    document.querySelector('.toc-text').addEventListener('mouseenter', toggleToc);
  }
}</script></body></html>