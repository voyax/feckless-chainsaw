<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>【转】彩色图像转换成灰度图像 | voya</title><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><script>var GLOBAL = { 
  root: '/',
  algolia: {"appId":"TJ6WR04MZ3","apiKey":"81961c3645425e892e7caa399f73e5b2","indexName":"blog","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script><link rel="icon" href="/favicon.ico"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://oe54phg1r.bkt.clouddn.com/blog/2017-09-26-2017-07-26-075816%20.jpg"></div><div class="author-info__name text-center">voya</div><div class="author-info__description text-center">Reading, Collecting, Thinking and Doing</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="../../archives"><span class="pull-left">文章</span><span class="pull-right">150</span></a><a class="author-info-articles__tags article-meta" href="../../tags"><span class="pull-left">标签</span><span class="pull-right">32</span></a><a class="author-info-articles__categories article-meta" href="../../categories"><span class="pull-left">分类</span><span class="pull-right">8</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://oe54phg1r.bkt.clouddn.com/blog/2017-09-26-2017-08-16-adam-whitlock-270558-cmp.jpg);"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">voya</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">【转】彩色图像转换成灰度图像</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2014-03-23</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"> </i><a class="post-meta__categories" href="../../categories/学习笔记/">学习笔记</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">1,189</span><span class="post-meta__separator">|</span><span>阅读时长: 4 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><p>图像处理中，大部分的处理方法都需要事先把彩<strong>色图像转换成灰度图像</strong>才能进行相关的计算、识别。<br>彩色图转换灰度图的原理如下：<br>我们知道彩色位图是由R/G/B三个分量组成，其文件存储格式为<br>BITMAPFILEHEADER+BITMAPINFOHEADER，紧跟后面的可能是:<br>如果是24位真彩图，则每个点是由三个字节分别表示R/G/B，所以这里直接跟着图像的色彩信息；<br>如果是8位（256色）,4位(16色)，1位(单色)图，则紧跟后面的是调色板数据，一个RGBQUAD类型的数组，其长度由BITMAPINFOHEADER.biClrUsed来决定。<br>然后后面紧跟的才是图像数据(24位图是真实的图像数据，其他的则是调色板的索引数据)。<br>灰度图是指只含亮度信息，不含色彩信息的图象，就象我们平时看到的黑白照片：亮度由暗到明，变化是连续的。因此，要表示灰度图，就需要把亮度值进行 量化。通常划分成0到255共256个级别，其中0最暗(全黑)，255最亮(全白)。在表示颜色的方法中，除了RGB外，还有一种叫YUV的表示方法， 应用也很多。电视信号中用的就是一种类似于YUV的颜色表示方法。在这种表示方法中，Y分量的物理含义就是亮度，Y分量包含了灰度图的所有信息，只用Y分 量就能完全能够表示出一幅灰度图来。<br>从 RGB 到 YUV 空间的 Y 转换公式为：<br>Y = 0.299R+0.587G+0.114B<br>在 WINDOWS 中，表示 16 位以上的图和以下的图有点不同； 16 位以下的图使用一个调色板来表示选择具体的颜色，调色板的每个单元是 4 个字节，其中一个透明度；而具体的像素值存储的是索引，分别是 1 、 2 、 4 、 8 位。 16 位以上的图直接使用像素表示颜色。<br>那么如何将彩色图转换为灰度图呢？<br>灰度图中有调色板，首先需要确定调色板的具体颜色取值。我们前面提到了，灰度图的三个分量相等。<br>当转换为 8 位的时候，调色板中有 256 个颜色，每个正好从 0 到 255 个，三个分量都相等。<br>当转换为 4 位的时候，调色板中 16 个颜色，等间隔平分 255 个颜色值，三个分量都相等。<br>当转换为 2 位的时候，调色板中 4 个颜色，等间隔平分 255 个颜色，三个分量相等。<br>当转换为 1 位的时候，调色板中两个颜色，是 0 和 255 ，表示黑和白。<br>将彩色转换为灰度时候，按照公式计算出对应的值，该值实际上是亮度的级别；亮度从 0 到 255 ；由于不同的位有不同的亮度级别，所以 Y 的具体取值如下：<br>Y = Y/ (1&lt;&lt;(8- 转换的位数 ));<br>所以，我们要转化成灰度图，并且存储成一幅可以看到的图像，需要做如下转换：<br>16位以上的图像不带调色板，只需要把图像数据按每个点的位数都转换成相同的灰度值即可<br>16位以下的图像，则需要修改调色板的数值，并且按照每个点所占位数修改灰度值索引即可。</p>
<p>&nbsp;</p>
<p>这个程序实现将彩色图像转换为灰度图像。</p>
<p>彩色转换为灰度使用如下公式：</p>
<pre>Gray = R * 0.299 + G * 0.587 + B * 0.114</pre>
为了提高运算速度，将这个公式转换为整数运算：
<pre>Gray = (R * 229 + G * 587 + B * 114 + 500) / 1000</pre>
为了提高运算速度的方法还有很多，这里作为演示，不再详述。

完整代码如下：
<pre>/////////////////////////////////////////////////////////
// 程序名称：彩色图片转换为灰阶图片
// 编译环境：Visual C++ 6.0 / 2010，EasyX 20130322(beta)
// 作    者：krissi &lt;zh@easyx.cn&gt;
// 最后修改：2013-1-19
//
#include &lt;graphics.h&gt;
#include &lt;conio.h&gt;

// 彩色图像转换为灰度图像
void  ColorToGray(IMAGE *pimg)
{
    DWORD *p = GetImageBuffer(pimg);
    COLORREF c;

    // 逐个像素点读取计算
    for(int i = pimg-&gt;getwidth() * pimg-&gt;getheight() - 1; i &gt;= 0; i--)
    {
        c = BGR(p[i]);
        c = (GetRValue(c) * 299 + GetGValue(c) * 587 + GetBValue(c) * 114 + 500) / 1000;
        p[i] = RGB(c, c, c);    // 由于是灰度值，无需再执行 BGR 转换
    }
}

// 主函数
void main()
{
    // 初始化绘图环境
    initgraph(640, 480);

    // 获取图像
    IMAGE img;
    loadimage(&amp;img, _T("c:\\test.jpg"));

    // 显示原始图像
    putimage(0, 0, &amp;img);

    // 按任意键转换为灰度图像
    getch();

    // 处理图像为灰度
    ColorToGray(&amp;img);

    // 显示处理后的图像
    putimage(0, 0, &amp;img);

    // 关闭绘图环境
    getch();
    closegraph();
}</pre></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info">voya</span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info">http://www.voyax.meposts/57990/</span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</span></div></div><div class="post-meta__tag-list"></div></article><nav id="pagination"><div class="prev-post pull-left"><a href="../../posts/40123/"><i class="fa fa-chevron-left">  </i><span>本学期第一次熬夜了啊</span></a></div><div class="next-post pull-right"><a href="../../posts/50892/"><span>解决Sublime Text 2中文乱码问题</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">©2016 - 2018 By voya</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Hosted by - </span><a href="https://pages.coding.me/"><span>Coding Pages</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.3"></script><script src="/js/fancybox.js?version=1.3"></script><script src="/js/sidebar.js?version=1.3"></script><script src="/js/copy.js?version=1.3"></script><script src="/js/fireworks.js?version=1.3"></script><script src="/js/transition.js?version=1.3"></script><script src="/js/scroll.js?version=1.3"></script><script src="/js/head.js?version=1.3"></script></body></html>